% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/measure-map.R
\name{measure_map_safely}
\alias{measure_map_safely}
\title{Apply a Function Safely to Each Sample's Measurements}
\usage{
measure_map_safely(
  .data,
  .f,
  .cols = NULL,
  ...,
  .otherwise = NULL,
  .error_call = rlang::caller_env()
)
}
\arguments{
\item{.data}{A data frame containing one or more \code{measure_list} columns.}

\item{.f}{A function or formula to apply to each sample's measurement tibble.
\itemize{
\item If a \strong{function}, it is used as-is.
\item If a \strong{formula} (e.g., \code{~ { .x$value <- log(.x$value); .x }}), it is
converted to a function using \code{\link[rlang:as_function]{rlang::as_function()}}.
}}

\item{.cols}{<\code{\link[dplyr:dplyr_tidy_select]{tidy-select}}> Columns to apply
the transformation to. Defaults to all \code{measure_list} columns.}

\item{...}{Additional arguments passed to \code{.f}.}

\item{.otherwise}{Value to use when \code{.f} fails for a sample. Default is
\code{NULL}, which keeps the original (untransformed) measurement.}

\item{.error_call}{The execution environment for error reporting.}
}
\value{
A list with two elements:
\itemize{
\item \code{result}: A data frame with transformations applied where successful
\item \code{errors}: A tibble with columns \code{column}, \code{sample}, and \code{error}
}
}
\description{
\code{measure_map_safely()} is a fault-tolerant version of \code{\link[=measure_map]{measure_map()}} that
captures errors instead of stopping execution. This is useful when exploring
data that may have problematic samples.
}
\examples{
library(recipes)

rec <- recipe(water + fat + protein ~ ., data = meats_long) |>
  update_role(id, new_role = "id") |>
  step_measure_input_long(transmittance, location = vars(channel)) |>
  prep()

baked_data <- bake(rec, new_data = NULL)

# A function that might fail for some samples
risky_transform <- function(x) {
  if (any(x$value < 0)) stop("Negative values not allowed")
  x$value <- log(x$value)
  x
}

# Errors are captured, not thrown
result <- measure_map_safely(baked_data, risky_transform)

# Check which samples failed
if (nrow(result$errors) > 0) {
  print(result$errors)
}
}
\seealso{
\code{\link[=measure_map]{measure_map()}} for standard (fail-fast) mapping
}
