% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/msc.R
\name{step_measure_msc}
\alias{step_measure_msc}
\title{Multiplicative Scatter Correction (MSC)}
\usage{
step_measure_msc(
  recipe,
  measures = NULL,
  role = NA,
  trained = FALSE,
  ref_spectra = NULL,
  skip = FALSE,
  id = recipes::rand_id("measure_msc")
)
}
\arguments{
\item{recipe}{A recipe object. The step will be added to the sequence of
operations for this recipe.}

\item{measures}{An optional character vector of measure column names to
process. If \code{NULL} (the default), all measure columns (columns with class
\code{measure_list}) will be processed. Use this to limit processing to specific
measure columns when working with multiple measurement types.}

\item{role}{Not used by this step since no new variables are created.}

\item{trained}{A logical to indicate if the quantities for preprocessing
have been estimated.}

\item{ref_spectra}{A named list of numeric vectors containing the reference
spectra computed during training for each measure column. This is \code{NULL}
until the step is trained.}

\item{skip}{A logical. Should the step be skipped when the recipe is baked
by \code{\link[recipes:bake]{recipes::bake()}}? While all operations are baked when \code{\link[recipes:prep]{recipes::prep()}} is run, some
operations may not be able to be conducted on new data (e.g. processing
the outcome variable(s)). Care should be taken when using \code{skip = TRUE}
as it may affect the computations for subsequent operations.}

\item{id}{A character string that is unique to this step to identify it.}
}
\value{
An updated version of \code{recipe} with the new step added to the
sequence of any existing operations.
}
\description{
\code{step_measure_msc()} creates a \emph{specification} of a recipe step that applies
Multiplicative Scatter Correction to spectral data. MSC removes physical
light scatter by accounting for additive and multiplicative effects.
}
\details{
Multiplicative Scatter Correction (MSC) is a normalization method that
attempts to account for additive and multiplicative effects by aligning
each spectrum to a reference spectrum. For a spectrum \eqn{x_i} and
reference \eqn{x_r}, the transformation is:

\deqn{x_i = m_i \cdot x_r + a_i}
\deqn{MSC(x_i) = \frac{x_i - a_i}{m_i}}

where \eqn{a_i} and \eqn{m_i} are the additive (intercept) and multiplicative
(slope) terms from regressing \eqn{x_i} on \eqn{x_r}.

The reference spectrum is computed as the mean of all training spectra during
\code{prep()} and stored for use when applying the transformation to new data.

MSC is commonly used to remove physical light scatter effects in NIR
spectroscopy caused by differences in particle size or path length.

\strong{No selectors should be supplied to this step function}. The data should be
in the internal format produced by \code{\link[=step_measure_input_wide]{step_measure_input_wide()}} or
\code{\link[=step_measure_input_long]{step_measure_input_long()}}.

The measurement locations are preserved unchanged.
}
\section{Tidying}{
When you \code{\link[recipes:tidy.recipe]{tidy()}} this step, a tibble with columns
\code{terms} (set to \code{".measures"}) and \code{id} is returned.
}

\examples{
library(recipes)

rec <-
  recipe(water + fat + protein ~ ., data = meats_long) |>
  update_role(id, new_role = "id") |>
  step_measure_input_long(transmittance, location = vars(channel)) |>
  step_measure_msc() |>
  prep()

bake(rec, new_data = NULL)
}
\references{
Geladi, P., MacDougall, D., and Martens, H. 1985. Linearization and
Scatter-Correction for Near-Infrared Reflectance Spectra of Meat.
Applied Spectroscopy, 39(3):491-500.
}
\seealso{
\code{\link[=step_measure_snv]{step_measure_snv()}} for a simpler scatter correction method

Other measure-preprocessing: 
\code{\link{step_measure_absorbance}()},
\code{\link{step_measure_calibrate_x}()},
\code{\link{step_measure_calibrate_y}()},
\code{\link{step_measure_derivative}()},
\code{\link{step_measure_derivative_gap}()},
\code{\link{step_measure_kubelka_munk}()},
\code{\link{step_measure_log}()},
\code{\link{step_measure_map}()},
\code{\link{step_measure_normalize_istd}()},
\code{\link{step_measure_ratio_reference}()},
\code{\link{step_measure_snv}()},
\code{\link{step_measure_subtract_blank}()},
\code{\link{step_measure_subtract_reference}()},
\code{\link{step_measure_transmittance}()}
}
\concept{measure-preprocessing}
