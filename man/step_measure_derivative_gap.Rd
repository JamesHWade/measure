% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/spectral-math.R
\name{step_measure_derivative_gap}
\alias{step_measure_derivative_gap}
\title{Gap (Norris-Williams) Derivatives}
\usage{
step_measure_derivative_gap(
  recipe,
  gap = 2L,
  segment = 1L,
  measures = NULL,
  role = NA,
  trained = FALSE,
  skip = FALSE,
  id = recipes::rand_id("measure_derivative_gap")
)
}
\arguments{
\item{recipe}{A recipe object. The step will be added to the sequence of
operations for this recipe.}

\item{gap}{The gap size (number of points to skip on each side). Default is
\code{2}. The derivative at point i is computed from points i-gap and i+gap.}

\item{segment}{The segment size for averaging. Default is \code{1} (no averaging).
When greater than 1, multiple points are averaged on each side before
computing the difference.}

\item{measures}{An optional character vector of measure column names to
process. If \code{NULL} (the default), all measure columns will be processed.}

\item{role}{Not used by this step since no new variables are created.}

\item{trained}{A logical to indicate if the step has been trained.}

\item{skip}{A logical. Should the step be skipped when baking?}

\item{id}{A character string that is unique to this step.}
}
\value{
An updated version of \code{recipe} with the new step added.
}
\description{
\code{step_measure_derivative_gap()} creates a \emph{specification} of a recipe step
that computes gap derivatives using the Norris-Williams method.
}
\details{
Gap derivatives compute the difference between points separated by a gap:

\deqn{\frac{dy}{dx} \approx \frac{y_{i+g} - y_{i-g}}{x_{i+g} - x_{i-g}}}{dy/dx â‰ˆ (y[i+g] - y[i-g]) / (x[i+g] - x[i-g])}

where \eqn{g} is the gap size.

When \code{segment > 1}, the Norris-Williams method is used, which averages
\code{segment} points on each side before computing the difference.

The spectrum length is reduced by \code{2 * gap} points.

Gap derivatives are often used in NIR chemometrics as an alternative to
Savitzky-Golay derivatives when less smoothing is desired.
}
\examples{
library(recipes)

# Gap derivative with gap=2
rec <- recipe(water + fat + protein ~ ., data = meats_long) |>
  update_role(id, new_role = "id") |>
  step_measure_input_long(transmittance, location = vars(channel)) |>
  step_measure_derivative_gap(gap = 2) |>
  prep()

# Norris-Williams with gap=3, segment=2
rec2 <- recipe(water + fat + protein ~ ., data = meats_long) |>
  update_role(id, new_role = "id") |>
  step_measure_input_long(transmittance, location = vars(channel)) |>
  step_measure_derivative_gap(gap = 3, segment = 2) |>
  prep()
}
\seealso{
\code{\link[=step_measure_derivative]{step_measure_derivative()}} for simple finite differences,
\code{\link[=step_measure_savitzky_golay]{step_measure_savitzky_golay()}} for smoothed derivatives

Other measure-preprocessing: 
\code{\link{step_measure_absorbance}()},
\code{\link{step_measure_calibrate_x}()},
\code{\link{step_measure_calibrate_y}()},
\code{\link{step_measure_derivative}()},
\code{\link{step_measure_kubelka_munk}()},
\code{\link{step_measure_log}()},
\code{\link{step_measure_map}()},
\code{\link{step_measure_msc}()},
\code{\link{step_measure_normalize_istd}()},
\code{\link{step_measure_ratio_reference}()},
\code{\link{step_measure_snv}()},
\code{\link{step_measure_subtract_blank}()},
\code{\link{step_measure_subtract_reference}()},
\code{\link{step_measure_transmittance}()}
}
\concept{measure-preprocessing}
