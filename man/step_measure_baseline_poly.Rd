% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/baseline-poly.R
\name{step_measure_baseline_poly}
\alias{step_measure_baseline_poly}
\title{Polynomial Baseline Correction}
\usage{
step_measure_baseline_poly(
  recipe,
  measures = NULL,
  degree = 2L,
  max_iter = 0L,
  threshold = 1.5,
  role = NA,
  trained = FALSE,
  skip = FALSE,
  id = recipes::rand_id("measure_baseline_poly")
)
}
\arguments{
\item{recipe}{A recipe object. The step will be added to the sequence of
operations for this recipe.}

\item{measures}{An optional character vector of measure column names to
process. If \code{NULL} (the default), all measure columns (columns with class
\code{measure_list}) will be processed.}

\item{degree}{Polynomial degree for baseline fitting. Default is \code{2}
(quadratic). Higher degrees fit more complex baselines but risk overfitting.
Tunable via \code{\link[=baseline_degree]{baseline_degree()}}.}

\item{max_iter}{Maximum number of iterations for peak exclusion. Default is
\code{0} (no iteration, fit polynomial to all points). Set to a positive integer
to iteratively exclude points above the fitted baseline.}

\item{threshold}{Number of standard deviations above baseline for a point to
be excluded in iterative fitting. Default is \code{1.5}. Only used when
\code{max_iter > 0}.}

\item{role}{Not used by this step since no new variables are created.}

\item{trained}{A logical to indicate if the quantities for preprocessing
have been estimated.}

\item{skip}{A logical. Should the step be skipped when the recipe is baked?}

\item{id}{A character string that is unique to this step to identify it.}
}
\value{
An updated version of \code{recipe} with the new step added to the
sequence of any existing operations.
}
\description{
\code{step_measure_baseline_poly()} creates a \emph{specification} of a recipe step
that applies polynomial baseline correction to measurement data. The method
fits a polynomial to the spectrum, optionally with iterative peak exclusion.
}
\details{
Polynomial baseline correction fits a polynomial function to the spectrum
and subtracts it. This is effective for removing smooth, curved baselines
caused by instrumental drift, scattering, or other slowly varying effects.

When \code{max_iter > 0}, the algorithm uses iterative peak exclusion:
\enumerate{
\item Fit polynomial to all points
\item Calculate residuals (spectrum - baseline)
\item Exclude points where residual > threshold * SD(residuals)
\item Refit polynomial to remaining points
\item Repeat until convergence or max_iter reached
}

This iterative approach prevents peaks from pulling up the baseline estimate.

\strong{Degree selection:}
\itemize{
\item \code{degree = 1}: Linear baseline (for simple drift)
\item \code{degree = 2}: Quadratic (most common, handles gentle curvature)
\item \code{degree = 3-5}: Higher-order (for complex baselines, use cautiously)
}

\strong{No selectors should be supplied to this step function}. The data should be
in the internal format produced by \code{\link[=step_measure_input_wide]{step_measure_input_wide()}} or
\code{\link[=step_measure_input_long]{step_measure_input_long()}}.
}
\section{Tidying}{
When you \code{\link[recipes:tidy.recipe]{tidy()}} this step, a tibble with columns
\code{terms}, \code{degree}, and \code{id} is returned.
}

\examples{
library(recipes)

# Simple polynomial baseline (no iteration)
rec <- recipe(water + fat + protein ~ ., data = meats_long) |>
  update_role(id, new_role = "id") |>
  step_measure_input_long(transmittance, location = vars(channel)) |>
  step_measure_baseline_poly(degree = 2) |>
  prep()

bake(rec, new_data = NULL)

# With iterative peak exclusion
rec2 <- recipe(water + fat + protein ~ ., data = meats_long) |>
  update_role(id, new_role = "id") |>
  step_measure_input_long(transmittance, location = vars(channel)) |>
  step_measure_baseline_poly(degree = 3, max_iter = 5, threshold = 2) |>
  prep()
}
\seealso{
Other measure-baseline: 
\code{\link{step_measure_baseline_airpls}()},
\code{\link{step_measure_baseline_als}()},
\code{\link{step_measure_baseline_custom}()},
\code{\link{step_measure_baseline_gpc}()},
\code{\link{step_measure_baseline_py}()},
\code{\link{step_measure_baseline_rf}()},
\code{\link{step_measure_baseline_rolling}()},
\code{\link{step_measure_baseline_snip}()},
\code{\link{step_measure_detrend}()}
}
\concept{measure-baseline}
