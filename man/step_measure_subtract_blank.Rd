% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/reference-subtract.R
\name{step_measure_subtract_blank}
\alias{step_measure_subtract_blank}
\title{Subtract Blank Measurement}
\usage{
step_measure_subtract_blank(
  recipe,
  blank = NULL,
  blank_col = NULL,
  blank_value = NULL,
  method = "subtract",
  measures = NULL,
  role = NA,
  trained = FALSE,
  learned_blank = NULL,
  skip = FALSE,
  id = recipes::rand_id("measure_subtract_blank")
)
}
\arguments{
\item{recipe}{A recipe object. The step will be added to the sequence of
operations for this recipe.}

\item{blank}{An optional external blank to use. Can be:
\itemize{
\item A \code{measure_tbl} object with \code{location} and \code{value} columns
\item A numeric vector (must match the number of locations in data)
\item A data.frame with \code{location} and \code{value} columns (will be interpolated)
If \code{NULL}, the blank is learned from training data using \code{blank_col} and
\code{blank_value}.
}}

\item{blank_col}{An optional column name (unquoted) that identifies sample
types. Used with \code{blank_value} to identify blank samples in training data.}

\item{blank_value}{The value in \code{blank_col} that identifies blank samples.
When the step is prepped, the mean of all blank samples is computed and
stored for use during baking.}

\item{method}{The correction method to apply:
\itemize{
\item \code{"subtract"} (default): Subtract the blank from each spectrum
\item \code{"divide"}: Divide each spectrum by the blank
}}

\item{measures}{An optional character vector of measure column names to
process. If \code{NULL} (the default), all measure columns (columns with class
\code{measure_list}) will be processed.}

\item{role}{Not used by this step since no new variables are created.}

\item{trained}{A logical to indicate if the quantities for preprocessing
have been estimated.}

\item{learned_blank}{A named list containing the learned blank values for
each measure column. This is \code{NULL} until the step is trained.}

\item{skip}{A logical. Should the step be skipped when the recipe is baked?}

\item{id}{A character string that is unique to this step to identify it.}
}
\value{
An updated version of \code{recipe} with the new step added to the
sequence of any existing operations.
}
\description{
\code{step_measure_subtract_blank()} creates a \emph{specification} of a recipe step
that subtracts or divides by a blank measurement. The blank can be provided
externally or learned from training data.
}
\details{
Blank subtraction is a fundamental preprocessing step in analytical
chemistry. It removes background signal that is present in all measurements
but is not related to the analyte of interest.

\strong{Two modes of operation:}
\enumerate{
\item \strong{External blank}: You provide a blank spectrum directly via the \code{blank}
argument. This is useful when you have a known reference blank.
\item \strong{Learned blank}: You specify which samples are blanks in your training
data using \code{blank_col} and \code{blank_value}. During \code{prep()}, the mean of
all blank samples is computed and stored. This approach is useful for
batch-specific blank correction.
}

\strong{Common use cases:}
\itemize{
\item UV-Vis: Remove solvent absorbance
\item IR: Remove atmospheric CO2/H2O interference
\item Fluorescence: Remove buffer background and Raman scatter
\item Chromatography: Remove ghost peaks and solvent artifacts
}

\strong{No selectors should be supplied to this step function}. The data should be
in the internal format produced by \code{\link[=step_measure_input_wide]{step_measure_input_wide()}} or
\code{\link[=step_measure_input_long]{step_measure_input_long()}}.
}
\section{Tidying}{
When you \code{\link[recipes:tidy.recipe]{tidy()}} this step, a tibble with columns
\code{terms}, \code{method}, \code{blank_source}, and \code{id} is returned.
}

\examples{
library(recipes)

# Example with external blank (numeric vector)
blank_spectrum <- rep(0.1, 100)

rec <- recipe(water + fat + protein ~ ., data = meats_long) |>
  update_role(id, new_role = "id") |>
  step_measure_input_long(transmittance, location = vars(channel)) |>
  step_measure_subtract_blank(blank = blank_spectrum)

# Example learning blank from training data
# (assuming sample_type column with "blank" values)
# rec <- recipe(outcome ~ ., data = my_data) |>
#   step_measure_input_long(...) |>
#   step_measure_subtract_blank(blank_col = sample_type, blank_value = "blank")
}
\seealso{
\code{\link[=step_measure_subtract_reference]{step_measure_subtract_reference()}} for simpler external reference

Other measure-preprocessing: 
\code{\link{step_measure_calibrate_x}()},
\code{\link{step_measure_calibrate_y}()},
\code{\link{step_measure_map}()},
\code{\link{step_measure_msc}()},
\code{\link{step_measure_normalize_istd}()},
\code{\link{step_measure_ratio_reference}()},
\code{\link{step_measure_snv}()},
\code{\link{step_measure_subtract_reference}()}
}
\concept{measure-preprocessing}
