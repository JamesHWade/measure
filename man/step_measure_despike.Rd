% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/despike.R
\name{step_measure_despike}
\alias{step_measure_despike}
\title{Remove Spikes and Outliers from Measurements}
\usage{
step_measure_despike(
  recipe,
  measures = NULL,
  window = 5L,
  threshold = 5,
  method = c("interpolate", "median", "mean"),
  max_width = 3L,
  role = NA,
  trained = FALSE,
  skip = FALSE,
  id = recipes::rand_id("measure_despike")
)
}
\arguments{
\item{recipe}{A recipe object.}

\item{measures}{An optional character vector of measure column names.}

\item{window}{The window size for local statistics. Must be an odd integer
of at least 3. Default is 5. Tunable via \code{\link[=smooth_window]{smooth_window()}}.}

\item{threshold}{The threshold multiplier for spike detection. Points
deviating more than \code{threshold * MAD} from the local median are flagged.
Default is 5. Tunable via \code{\link[=despike_threshold]{despike_threshold()}}.}

\item{method}{How to replace detected spikes. One of
\code{"interpolate"} (default, linear interpolation from neighbors),
\code{"median"} (replace with local median), or
\code{"mean"} (replace with local mean).}

\item{max_width}{Maximum width (in points) of a spike. Consecutive outliers
wider than this are not considered spikes. Default is 3.}

\item{role}{Not used.}

\item{trained}{Logical indicating if the step has been trained.}

\item{skip}{Logical. Should the step be skipped when baking?}

\item{id}{Unique step identifier.}
}
\value{
An updated recipe with the new step added.
}
\description{
\code{step_measure_despike()} creates a \emph{specification} of a recipe step that
detects and removes spikes (sudden, brief outliers) from measurement data.
Spikes are common artifacts in spectroscopy (cosmic rays in Raman, detector
glitches) and chromatography (electrical noise).
}
\details{
Spike detection uses a robust local statistic approach:
\enumerate{
\item For each point, calculate the local median and MAD (Median Absolute
Deviation) within a sliding window
\item Flag points where \verb{|value - local_median| > threshold * MAD}
\item Group consecutive flagged points into spike regions
\item If a spike region is narrower than \code{max_width}, replace with the
specified method
}

MAD is scaled by 1.4826 to be consistent with standard deviation for
normally distributed data.

This approach is robust because:
\itemize{
\item Median and MAD are not affected by the spikes themselves
\item The threshold adapts to local noise levels
\item The max_width parameter prevents removing genuine peaks
}
}
\examples{
library(recipes)

rec <- recipe(water + fat + protein ~ ., data = meats_long) |>
  update_role(id, new_role = "id") |>
  step_measure_input_long(transmittance, location = vars(channel)) |>
  step_measure_despike(threshold = 5) |>
  prep()

bake(rec, new_data = NULL)
}
\seealso{
Other measure-smoothing: 
\code{\link{step_measure_filter_fourier}()},
\code{\link{step_measure_savitzky_golay}()},
\code{\link{step_measure_smooth_gaussian}()},
\code{\link{step_measure_smooth_ma}()},
\code{\link{step_measure_smooth_median}()},
\code{\link{step_measure_smooth_wavelet}()}
}
\concept{measure-smoothing}
