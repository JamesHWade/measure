% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dilution-correction.R
\name{step_measure_dilution_correct}
\alias{step_measure_dilution_correct}
\title{Dilution Factor Correction}
\usage{
step_measure_dilution_correct(
  recipe,
  ...,
  dilution_col = "dilution_factor",
  operation = c("multiply", "divide"),
  handle_zero = c("error", "warn", "skip"),
  role = NA,
  trained = FALSE,
  skip = FALSE,
  id = recipes::rand_id("measure_dilution_correct")
)
}
\arguments{
\item{recipe}{A recipe object.}

\item{...}{One or more selector functions to choose feature columns
(concentration values) to correct. If empty, all numeric columns
(excluding metadata columns) will be selected.}

\item{dilution_col}{Name of the column containing dilution factors.
Default is \code{"dilution_factor"}.}

\item{operation}{How to apply the dilution factor:
\itemize{
\item \code{"multiply"} (default): \code{concentration * dilution_factor} (back-calculate
from diluted to original concentration)
\item \code{"divide"}: \code{concentration / dilution_factor} (apply dilution)
}}

\item{handle_zero}{How to handle zero dilution factors:
\itemize{
\item \code{"error"} (default): Stop with an error
\item \code{"warn"}: Warn and set result to NA
\item \code{"skip"}: Silently set result to NA
}}

\item{role}{Not used by this step.}

\item{trained}{Logical indicating if the step has been trained.}

\item{skip}{Logical. Should the step be skipped when baking?}

\item{id}{Unique step identifier.}
}
\value{
An updated recipe with the new step added.
}
\description{
\code{step_measure_dilution_correct()} creates a \emph{specification} of a recipe step
that corrects concentration values by applying dilution factors. This is
essential when samples are diluted during preparation and need to be
back-calculated to original concentrations.
}
\details{
\subsection{Dilution Factor Interpretation}{

The dilution factor represents how much the sample was diluted:
\itemize{
\item A factor of 1 means no dilution (undiluted)
\item A factor of 2 means 1:2 dilution (1 part sample + 1 part diluent)
\item A factor of 10 means 1:10 dilution
}
}

\subsection{Back-Calculation}{

When using \code{operation = "multiply"} (the default):
\code{original_concentration = measured_concentration * dilution_factor}

This corrects for the dilution to get the true concentration in the
original sample.
}

\subsection{When to Use}{

Use this step after quantitation (calibration) when samples were diluted
to bring concentrations within the calibration range.
}
}
\examples{
library(recipes)

# Example: samples diluted to fit calibration range
data <- data.frame(
  sample_id = paste0("S", 1:6),
  dilution_factor = c(1, 2, 5, 10, 1, 1),
  analyte = c(50, 45, 42, 48, 51, 49)  # Measured after dilution
)

rec <- recipe(~ ., data = data) |>
  update_role(sample_id, new_role = "id") |>
  step_measure_dilution_correct(
    analyte,
    dilution_col = "dilution_factor",
    operation = "multiply"
  ) |>
  prep()

# Back-calculated concentrations
bake(rec, new_data = NULL)
# S1: 50*1=50, S2: 45*2=90, S3: 42*5=210, S4: 48*10=480
}
\seealso{
\code{\link[=step_measure_surrogate_recovery]{step_measure_surrogate_recovery()}}, \code{\link[=measure_calibration_predict]{measure_calibration_predict()}}

Other calibration: 
\code{\link{measure_matrix_effect}()},
\code{\link{step_measure_standard_addition}()},
\code{\link{step_measure_surrogate_recovery}()}
}
\concept{calibration}
