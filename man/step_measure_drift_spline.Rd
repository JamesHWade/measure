% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/drift-correction.R
\name{step_measure_drift_spline}
\alias{step_measure_drift_spline}
\title{Spline-Based Drift Correction}
\usage{
step_measure_drift_spline(
  recipe,
  ...,
  run_order_col = "run_order",
  sample_type_col = "sample_type",
  qc_type = "qc",
  apply_to = c("all", "unknown"),
  df = NULL,
  spar = NULL,
  min_qc = 4,
  role = NA,
  trained = FALSE,
  skip = FALSE,
  id = recipes::rand_id("measure_drift_spline")
)
}
\arguments{
\item{recipe}{A recipe object.}

\item{...}{One or more selector functions to choose feature columns. For
feature-level data, select the numeric response columns. For curve-level
data with \code{.measures}, leave empty to apply to all locations.}

\item{run_order_col}{Name of the column containing run order (injection
sequence). Must be numeric/integer.}

\item{sample_type_col}{Name of the column containing sample type.}

\item{qc_type}{Value(s) in \code{sample_type_col} that identify QC samples to
use for drift modeling. Default is \code{"qc"}.}

\item{apply_to}{Which samples to apply correction to:
\itemize{
\item \code{"all"} (default): Correct all samples
\item \code{"unknown"}: Only correct unknown samples
}}

\item{df}{Degrees of freedom for the smoothing spline. Default is NULL,
which uses cross-validation to select optimal df. Lower values = smoother.}

\item{spar}{Smoothing parameter (alternative to df). If NULL (default),
cross-validation is used.}

\item{min_qc}{Minimum number of QC samples required. Default is 5.}

\item{role}{Not used by this step.}

\item{trained}{Logical indicating if the step has been trained.}

\item{skip}{Logical. Should the step be skipped when baking?}

\item{id}{Unique step identifier.}
}
\value{
An updated recipe with the new step added.
}
\description{
\code{step_measure_drift_spline()} creates a \emph{specification} of a recipe step
that corrects for signal drift using smoothing splines fit to QC samples.
This offers more flexibility than linear correction while being more stable
than LOESS for sparse QC data.
}
\details{
\subsection{How It Works}{

Uses \code{\link[stats:smooth.spline]{stats::smooth.spline()}} to fit a flexible curve through QC responses.
The spline automatically adapts to the data complexity when \code{df} is not
specified.
}

\subsection{Comparison with Other Methods}{\tabular{lll}{
   Method \tab Best For \tab Min QC Samples \cr
   Linear \tab Simple linear drift \tab 3 \cr
   Spline \tab Moderate non-linearity \tab 4+ \cr
   LOESS \tab Complex patterns \tab 5+ \cr
}

}
}
\examples{
library(recipes)

# Data with non-linear drift
set.seed(123)
data <- data.frame(
  sample_id = paste0("S", 1:30),
  sample_type = rep(c("qc", "unknown", "unknown", "unknown", "unknown", "qc"), 5),
  run_order = 1:30,
  feature1 = 100 + sin((1:30) / 5) * 10 + rnorm(30, sd = 2)
)

rec <- recipe(~ ., data = data) |>
  update_role(sample_id, new_role = "id") |>
  step_measure_drift_spline(feature1) |>
  prep()

corrected <- bake(rec, new_data = NULL)
}
\seealso{
\code{\link[=step_measure_drift_linear]{step_measure_drift_linear()}} for linear correction,
\code{\link[=step_measure_drift_qc_loess]{step_measure_drift_qc_loess()}} for LOESS-based correction.

Other drift-correction: 
\code{\link{step_measure_drift_linear}()},
\code{\link{step_measure_drift_qc_loess}()},
\code{\link{step_measure_qc_bracket}()}
}
\concept{drift-correction}
