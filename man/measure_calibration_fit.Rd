% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calibration-fit.R
\name{measure_calibration_fit}
\alias{measure_calibration_fit}
\title{Fit a Calibration Curve}
\usage{
measure_calibration_fit(
  data,
  formula,
  model = c("linear", "quadratic"),
  weights = c("none", "1/x", "1/x2", "1/y", "1/y2"),
  origin = FALSE,
  outlier_method = c("none", "studentized", "cook"),
  outlier_threshold = NULL,
  outlier_action = c("flag", "remove"),
  sample_type_col = NULL
)
}
\arguments{
\item{data}{A data frame containing calibration data.}

\item{formula}{A formula specifying the model. The left-hand side should
be the response variable, and the right-hand side should be the
concentration variable (e.g., \code{response ~ nominal_conc}).}

\item{model}{Model type: \code{"linear"} (default) or \code{"quadratic"}.}

\item{weights}{Weighting scheme:
\itemize{
\item \code{"none"} (default): Unweighted regression
\item \code{"1/x"}: Weight by 1/concentration
\item \code{"1/x2"}: Weight by 1/concentration^2
\item \code{"1/y"}: Weight by 1/response
\item \code{"1/y2"}: Weight by 1/response^2
\item A numeric vector of custom weights (must match data rows)
}}

\item{origin}{Logical. If TRUE, force the curve through the origin (zero
intercept). Default is FALSE.}

\item{outlier_method}{Method for flagging outliers:
\itemize{
\item \code{"none"} (default): No outlier detection
\item \code{"studentized"}: Flag points with |studentized residual| > \code{outlier_threshold}
\item \code{"cook"}: Flag points with Cook's distance > \code{outlier_threshold}
}}

\item{outlier_threshold}{Threshold for outlier detection. Default is 2.5
for studentized residuals or 1 for Cook's distance.}

\item{outlier_action}{What to do with outliers:
\itemize{
\item \code{"flag"} (default): Flag but include in fit
\item \code{"remove"}: Remove from fit (with audit trail)
}}

\item{sample_type_col}{Optional column name for sample type. If provided,
only rows with \code{sample_type == "standard"} are used for fitting.}
}
\value{
A \link{measure_calibration} object containing the fitted model,
diagnostics, and metadata.
}
\description{
Fits a weighted or unweighted calibration curve for quantitation.
Supports linear and quadratic models with various weighting schemes.
}
\details{
\subsection{Weighting}{

Weighting is essential when response variance changes with concentration
(heteroscedasticity). Common patterns:
\itemize{
\item Constant CV: Use \code{"1/x2"} or \code{"1/y2"}
\item Constant absolute error: Use \code{"none"}
\item Proportional error: Use \code{"1/x"} or \code{"1/y"}
}
}

\subsection{Outlier Handling}{

By default, outliers are flagged but NOT removed. This follows the
principle of "flag, don't drop" for analytical data. If removal is
enabled, the removed points are stored in the result for audit purposes.
}
}
\examples{
# Simple linear calibration
data <- data.frame(
  nominal_conc = c(0, 10, 25, 50, 100, 200),
  response = c(0.5, 15.2, 35.8, 72.1, 148.3, 295.7)
)
cal <- measure_calibration_fit(data, response ~ nominal_conc)
print(cal)

# Weighted calibration (1/x^2)
cal_weighted <- measure_calibration_fit(
  data,
  response ~ nominal_conc,
  weights = "1/x2"
)

# Quadratic model
cal_quad <- measure_calibration_fit(
  data,
  response ~ nominal_conc,
  model = "quadratic"
)

}
\seealso{
\code{\link[=measure_calibration_predict]{measure_calibration_predict()}} for prediction,
\code{\link[=autoplot.measure_calibration]{autoplot.measure_calibration()}} for diagnostic plots,
\code{\link[=tidy.measure_calibration]{tidy.measure_calibration()}} for extracting coefficients.
}
