% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/surrogate-recovery.R
\name{step_measure_surrogate_recovery}
\alias{step_measure_surrogate_recovery}
\title{Surrogate/Internal Standard Recovery}
\usage{
step_measure_surrogate_recovery(
  recipe,
  ...,
  expected_col = NULL,
  expected_value = NULL,
  recovery_suffix = "_recovery",
  action = c("add_column", "flag", "filter"),
  flag_col = ".surrogate_pass",
  min_recovery = 70,
  max_recovery = 130,
  role = "surrogate",
  trained = FALSE,
  skip = FALSE,
  id = recipes::rand_id("measure_surrogate_recovery")
)
}
\arguments{
\item{recipe}{A recipe object.}

\item{...}{One or more selector functions to choose surrogate columns
(measured concentrations or responses).}

\item{expected_col}{Name of a column containing expected concentrations
for each sample. Mutually exclusive with \code{expected_value}.}

\item{expected_value}{A fixed numeric value for expected concentration.
Used when all surrogates have the same expected value. Mutually
exclusive with \code{expected_col}.}

\item{recovery_suffix}{Suffix appended to column names for recovery output.
Default is \code{"_recovery"}.}

\item{action}{What to do with recovery calculations:
\itemize{
\item \code{"add_column"} (default): Add new columns with recovery percentages
\item \code{"flag"}: Add a boolean column indicating if recovery is within limits
\item \code{"filter"}: Remove rows where any surrogate is outside limits
}}

\item{flag_col}{Name of the flag column when \code{action = "flag"}. Default is
\code{".surrogate_pass"}.}

\item{min_recovery}{Minimum acceptable recovery percentage. Default is 70.}

\item{max_recovery}{Maximum acceptable recovery percentage. Default is 130.}

\item{role}{Recipe role for new recovery columns. Default is \code{"surrogate"}.}

\item{trained}{Logical indicating if the step has been trained.}

\item{skip}{Logical. Should the step be skipped when baking?}

\item{id}{Unique step identifier.}
}
\value{
An updated recipe with the new step added.
}
\description{
\code{step_measure_surrogate_recovery()} creates a \emph{specification} of a recipe step
that calculates recovery percentages for surrogate or internal standards.
This is essential for quality control in analytical workflows where spiked
compounds are used to monitor method performance.
}
\details{
\subsection{Recovery Calculation}{

Recovery is calculated as:
\code{recovery_pct = (measured / expected) * 100}

Where:
\itemize{
\item \code{measured} is the observed concentration/response of the surrogate
\item \code{expected} is the known spike amount or theoretical value
}
}

\subsection{Acceptance Criteria}{

Typical acceptance limits vary by application:
\itemize{
\item \strong{ICH M10 (Bioanalytical)}: 70-130\% for surrogates
\item \strong{EPA Methods}: Often 50-150\% or method-specific
\item \strong{FDA Guidance}: Application-specific, often 80-120\%
}
}

\subsection{Use Cases}{
\itemize{
\item Monitor extraction efficiency in sample preparation
\item Track instrument performance across runs
\item Identify samples with matrix effects or procedural errors
}
}
}
\examples{
library(recipes)

# Example: QC data with spiked surrogates
qc_data <- data.frame(
  sample_id = paste0("QC", 1:10),
  surrogate_1 = rnorm(10, mean = 100, sd = 10),
  surrogate_2 = rnorm(10, mean = 50, sd = 5),
  analyte = rnorm(10, mean = 75, sd = 8)
)

# Add recovery columns for surrogates with expected value of 100 and 50
rec <- recipe(~ ., data = qc_data) |>
  update_role(sample_id, new_role = "id") |>
  step_measure_surrogate_recovery(
    surrogate_1,
    expected_value = 100,
    min_recovery = 80,
    max_recovery = 120
  ) |>
  prep()

bake(rec, new_data = NULL)
}
\seealso{
\code{\link[=step_measure_dilution_correct]{step_measure_dilution_correct()}}, \code{\link[=measure_matrix_effect]{measure_matrix_effect()}}

Other calibration: 
\code{\link{measure_matrix_effect}()},
\code{\link{step_measure_dilution_correct}()},
\code{\link{step_measure_standard_addition}()}
}
\concept{calibration}
