% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/scatter-extended.R
\name{step_measure_emsc}
\alias{step_measure_emsc}
\title{Extended Multiplicative Scatter Correction (EMSC)}
\usage{
step_measure_emsc(
  recipe,
  degree = 2L,
  reference = "mean",
  measures = NULL,
  role = NA,
  trained = FALSE,
  ref_spectrum = NULL,
  locations = NULL,
  skip = FALSE,
  id = recipes::rand_id("measure_emsc")
)
}
\arguments{
\item{recipe}{A recipe object.}

\item{degree}{Polynomial degree for wavelength-dependent terms. Default is 2.
Higher values can model more complex scatter effects but risk overfitting.}

\item{reference}{Reference spectrum method: \code{"mean"} (default) or \code{"median"}.
Alternatively, a numeric vector can be supplied as the reference spectrum.}

\item{measures}{An optional character vector of measure column names.}

\item{role}{Not used.}

\item{trained}{Logical indicating if the step has been trained.}

\item{ref_spectrum}{The learned reference spectrum (after training).}

\item{locations}{The location values for polynomial terms (after training).}

\item{skip}{Logical. Should the step be skipped when baking?}

\item{id}{Unique step identifier.}
}
\value{
An updated recipe with the new step added.
}
\description{
\code{step_measure_emsc()} creates a \emph{specification} of a recipe step that applies
Extended Multiplicative Scatter Correction to spectral data. EMSC accounts
for wavelength-dependent scatter effects using polynomial terms.
}
\details{
Extended MSC (EMSC) extends standard MSC by modeling wavelength-dependent
scatter effects. For a spectrum \eqn{x_i} and reference \eqn{x_r}, the model is:

\deqn{x_i = a_i + b_i \cdot x_r + c_i \cdot \lambda + d_i \cdot \lambda^2 + ... + \epsilon}

The corrected spectrum is:

\deqn{EMSC(x_i) = \frac{x_i - a_i - c_i \cdot \lambda - d_i \cdot \lambda^2 - ...}{b_i}}

The polynomial terms (\eqn{\lambda}, \eqn{\lambda^2}, etc.) account for
wavelength-dependent baseline effects that vary between samples.

\strong{When to use EMSC vs MSC:}
\itemize{
\item Use MSC for simple additive/multiplicative scatter
\item Use EMSC when scatter effects vary with wavelength
\item Start with degree=2, increase if needed for complex scatter
}
}
\examples{
library(recipes)

rec <- recipe(water + fat + protein ~ ., data = meats_long) |>
  update_role(id, new_role = "id") |>
  step_measure_input_long(transmittance, location = vars(channel)) |>
  step_measure_emsc(degree = 2) |>
  prep()

bake(rec, new_data = NULL)
}
\seealso{
\code{\link[=step_measure_msc]{step_measure_msc()}} for standard MSC

Other measure-preprocessing: 
\code{\link{step_measure_absorbance}()},
\code{\link{step_measure_calibrate_x}()},
\code{\link{step_measure_calibrate_y}()},
\code{\link{step_measure_derivative}()},
\code{\link{step_measure_derivative_gap}()},
\code{\link{step_measure_kubelka_munk}()},
\code{\link{step_measure_log}()},
\code{\link{step_measure_map}()},
\code{\link{step_measure_msc}()},
\code{\link{step_measure_normalize_istd}()},
\code{\link{step_measure_osc}()},
\code{\link{step_measure_ratio_reference}()},
\code{\link{step_measure_snv}()},
\code{\link{step_measure_subtract_blank}()},
\code{\link{step_measure_subtract_reference}()},
\code{\link{step_measure_transmittance}()}
}
\concept{measure-preprocessing}
