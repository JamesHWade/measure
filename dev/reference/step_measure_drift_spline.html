<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Spline-Based Drift Correction — step_measure_drift_spline • measure</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spline-Based Drift Correction — step_measure_drift_spline"><meta name="description" content="step_measure_drift_spline() creates a specification of a recipe step
that corrects for signal drift using smoothing splines fit to QC samples.
This offers more flexibility than linear correction while being more stable
than LOESS for sparse QC data."><meta property="og:description" content="step_measure_drift_spline() creates a specification of a recipe step
that corrects for signal drift using smoothing splines fit to QC samples.
This offers more flexibility than linear correction while being more stable
than LOESS for sparse QC data."><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">measure</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.0.1.9002</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/measure.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/measure.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Guides</h6></li>
    <li><a class="dropdown-item" href="../articles/preprocessing.html">Preprocessing Techniques</a></li>
    <li><a class="dropdown-item" href="../articles/multidimensional.html">Multi-Dimensional Data</a></li>
    <li><a class="dropdown-item" href="../articles/recipes.html">Integrating with tidymodels</a></li>
    <li><a class="dropdown-item" href="../articles/roles-diagnostics.html">Data Organization &amp; Diagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/validation.html">Analytical Validation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Examples</h6></li>
    <li><a class="dropdown-item" href="../articles/baseline.html">Baseline Correction</a></li>
    <li><a class="dropdown-item" href="../articles/sec-analysis-example.html">Bioreactor Case Study</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Developer</h6></li>
    <li><a class="dropdown-item" href="../articles/internals.html">Internal Class System</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JamesHWade/measure/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Spline-Based Drift Correction</h1>
      <small class="dont-index">Source: <a href="https://github.com/JamesHWade/measure/blob/main/R/drift-correction.R" class="external-link"><code>R/drift-correction.R</code></a></small>
      <div class="d-none name"><code>step_measure_drift_spline.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>step_measure_drift_spline()</code> creates a <em>specification</em> of a recipe step
that corrects for signal drift using smoothing splines fit to QC samples.
This offers more flexibility than linear correction while being more stable
than LOESS for sparse QC data.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">step_measure_drift_spline</span><span class="op">(</span></span>
<span>  <span class="va">recipe</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  run_order_col <span class="op">=</span> <span class="st">"run_order"</span>,</span>
<span>  sample_type_col <span class="op">=</span> <span class="st">"sample_type"</span>,</span>
<span>  qc_type <span class="op">=</span> <span class="st">"qc"</span>,</span>
<span>  apply_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"unknown"</span><span class="op">)</span>,</span>
<span>  df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  spar <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  min_qc <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  role <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  trained <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  skip <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  id <span class="op">=</span> <span class="fu">recipes</span><span class="fu">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/rand_id.html" class="external-link">rand_id</a></span><span class="op">(</span><span class="st">"measure_drift_spline"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-recipe">recipe<a class="anchor" aria-label="anchor" href="#arg-recipe"></a></dt>
<dd><p>A recipe object.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>One or more selector functions to choose feature columns. For
feature-level data, select the numeric response columns. For curve-level
data with <code>.measures</code>, leave empty to apply to all locations.</p></dd>


<dt id="arg-run-order-col">run_order_col<a class="anchor" aria-label="anchor" href="#arg-run-order-col"></a></dt>
<dd><p>Name of the column containing run order (injection
sequence). Must be numeric/integer.</p></dd>


<dt id="arg-sample-type-col">sample_type_col<a class="anchor" aria-label="anchor" href="#arg-sample-type-col"></a></dt>
<dd><p>Name of the column containing sample type.</p></dd>


<dt id="arg-qc-type">qc_type<a class="anchor" aria-label="anchor" href="#arg-qc-type"></a></dt>
<dd><p>Value(s) in <code>sample_type_col</code> that identify QC samples to
use for drift modeling. Default is <code>"qc"</code>.</p></dd>


<dt id="arg-apply-to">apply_to<a class="anchor" aria-label="anchor" href="#arg-apply-to"></a></dt>
<dd><p>Which samples to apply correction to:</p><ul><li><p><code>"all"</code> (default): Correct all samples</p></li>
<li><p><code>"unknown"</code>: Only correct unknown samples</p></li>
</ul></dd>


<dt id="arg-df">df<a class="anchor" aria-label="anchor" href="#arg-df"></a></dt>
<dd><p>Degrees of freedom for the smoothing spline. Default is NULL,
which uses cross-validation to select optimal df. Lower values = smoother.</p></dd>


<dt id="arg-spar">spar<a class="anchor" aria-label="anchor" href="#arg-spar"></a></dt>
<dd><p>Smoothing parameter (alternative to df). If NULL (default),
cross-validation is used.</p></dd>


<dt id="arg-min-qc">min_qc<a class="anchor" aria-label="anchor" href="#arg-min-qc"></a></dt>
<dd><p>Minimum number of QC samples required. Default is 5.</p></dd>


<dt id="arg-role">role<a class="anchor" aria-label="anchor" href="#arg-role"></a></dt>
<dd><p>Not used by this step.</p></dd>


<dt id="arg-trained">trained<a class="anchor" aria-label="anchor" href="#arg-trained"></a></dt>
<dd><p>Logical indicating if the step has been trained.</p></dd>


<dt id="arg-skip">skip<a class="anchor" aria-label="anchor" href="#arg-skip"></a></dt>
<dd><p>Logical. Should the step be skipped when baking?</p></dd>


<dt id="arg-id">id<a class="anchor" aria-label="anchor" href="#arg-id"></a></dt>
<dd><p>Unique step identifier.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An updated recipe with the new step added.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<div class="section">
<h3 id="how-it-works">How It Works<a class="anchor" aria-label="anchor" href="#how-it-works"></a></h3>


<p>Uses <code><a href="https://rdrr.io/r/stats/smooth.spline.html" class="external-link">stats::smooth.spline()</a></code> to fit a flexible curve through QC responses.
The spline automatically adapts to the data complexity when <code>df</code> is not
specified.</p>
</div>

<div class="section">
<h3 id="comparison-with-other-methods">Comparison with Other Methods<a class="anchor" aria-label="anchor" href="#comparison-with-other-methods"></a></h3>
<table class="table table"><tr><td>Method</td><td>Best For</td><td>Min QC Samples</td></tr><tr><td>Linear</td><td>Simple linear drift</td><td>3</td></tr><tr><td>Spline</td><td>Moderate non-linearity</td><td>4+</td></tr><tr><td>LOESS</td><td>Complex patterns</td><td>5+</td></tr></table></div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="step_measure_drift_linear.html">step_measure_drift_linear()</a></code> for linear correction,
<code><a href="step_measure_drift_qc_loess.html">step_measure_drift_qc_loess()</a></code> for LOESS-based correction.</p>
<p>Other drift-correction:
<code><a href="step_measure_drift_linear.html">step_measure_drift_linear()</a></code>,
<code><a href="step_measure_drift_qc_loess.html">step_measure_drift_qc_loess()</a></code>,
<code><a href="step_measure_qc_bracket.html">step_measure_qc_bracket()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/recipes" class="external-link">recipes</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Data with non-linear drift</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  sample_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  sample_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"qc"</span>, <span class="st">"unknown"</span>, <span class="st">"unknown"</span>, <span class="st">"unknown"</span>, <span class="st">"unknown"</span>, <span class="st">"qc"</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  run_order <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>,</span></span>
<span class="r-in"><span>  feature1 <span class="op">=</span> <span class="fl">100</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span> <span class="op">/</span> <span class="fl">5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/roles.html" class="external-link">update_role</a></span><span class="op">(</span><span class="va">sample_id</span>, new_role <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">step_measure_drift_spline</span><span class="op">(</span><span class="va">feature1</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html" class="external-link">prep</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">corrected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html" class="external-link">bake</a></span><span class="op">(</span><span class="va">rec</span>, new_data <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by James Wade.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

